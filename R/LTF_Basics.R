# MESSAGES #####################################################################

# =============================================================================.
#
# -----------------------------------------------------------------------------.
.ttmsg. <- function(a, b) {
  # txt_pad(txt_pad(x = " ", a, n = 23), "|", b, x = " ", n = 48) # identical
  paste(str_pad(a, 23), "|", str_pad(b, 22, side = "right"))
}
# =============================================================================.
# Examples:
# txt_pad("A", x = "-", "B", x = "-", "C", n = 15)
# c(
#   txt_pad(x = "/", "title", x = "/"),
#   txt_pad("=", "title", x = "="),
#   txt_pad(x = "-", "title", "-"),
#   txt_pad("name", x = ".", "description")
# )
# -----------------------------------------------------------------------------.
txt_pad <- function(..., sep = " ", n = NULL, indent = 0, split_lines = F) {

  s <- list(...)
  x <- names(s) == "x"
  s <- as.character(s)
  l <- nchar(s)

  # Resolve character expansions
  xc <- sum(l[x])
  cc <- sum(l[! x])
  sc <- nchar(sep) * (length(s) - 1)

  nx <- rep(0, length(s))

  if(sep == "\n") {

    if(is.null(n) & sum(x) > 0) n <- max(l[! x])
    nx[x] <- n

  } else {

    if(is.null(n)) n <- 80
    nx <- (l * ! x) + x * (n - (cc + sc)) %/% xc

    nt <- sum(nx) + sc
    if(xc > 1 & nt < n) {
      k <- which(x)[sum(x) - ((n - nt):1)]
      nx[k] <- nx[k] + 1
    }
  }

  # Make character expansions
  s[x] <- str_pad("", width = nx[x], pad = s[x])
  s <- paste(s, collapse = sep)

  # Make indentation
  if(indent > 0) {
    indent <- str_pad("", width = indent, pad = " ")
    s <- gsub("^", indent, s)
    s <- gsub("\n", paste0("\n", indent), s)
  }

  # Split lines
  if(split_lines) s <- unlist(str_split(s, "\n"))

  s
}
# =============================================================================.
# Try: txt_out("A", x = "-", "B", x = "-", "C", n = 15, sep = "\n", indent = 4)
# -----------------------------------------------------------------------------.
txt_out <- function(..., file = "", append = F) {
  txt <- txt_pad(...)
  cat(txt, "\n", sep = "", file = file, append = append)
}
# =============================================================================.
#' checklist
# -----------------------------------------------------------------------------.
#' @param chk logical vector
#' @param lst character vector
#' @param msg message
# -----------------------------------------------------------------------------.
#' @return NULL
# -----------------------------------------------------------------------------.
checklist <- function(chk, lst, msg = "", spc = "\n") {
  if(! all(chk)) {
    msg <- paste0(msg, spc, paste(lst[! chk], collapse = spc, sep = ""))
    stop(msg)
  }
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
txt_sep <- function(
  x = "-", begin = "", ctr = "", end = "", sep = "", n = 80
) {
  n <- n - (nchar(begin) + nchar(end) + nchar(sep))
  if(n < 0) n <- 0
  if(x != "") {
    str <- paste0(begin, str_pad("", n, pad = x), paste0(end), sep = sep)
  } else {
    str <- paste0(begin, paste0(end), sep = sep)
  }
  str
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
msg_line <- function(x = "-", begin = "", end = "", sep = "", n = 80, ...) {
  n <- n - (nchar(begin) + nchar(end) + nchar(sep))
  if(n < 0) n <- 0
  if(x != "") {
    cat(begin, str_pad("", n, pad = x), paste0(end, "\n"), sep = sep, ...)
  } else {
    cat(begin, paste0(end, "\n"), sep = sep, ...)
  }
}

# EXECUTION ####################################################################

# =============================================================================.
#
# -----------------------------------------------------------------------------.
confirm_execution <- function(q = T) {
  x <- readline("Proceed [y/n]? ")
  r <- T
  if(! grepl("^(y|yes)$", x, perl = T, ignore.case = T)) {
    cat("Cancelled\n")
    if(q) quit() else r <- F
  }
  r
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
execute <- function(x, ...) {
  all(sapply(x, system, ...) == 0)
}

# PKG INFO #####################################################################

# =============================================================================.
#
# -----------------------------------------------------------------------------.
exec_path <- function() {
  paste0(inst("LittleThumb"), "/exec")
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
modules_path <- function() {
  paste0(inst("LittleThumb"), "/modules")
}

# SYS INFO #####################################################################

# =============================================================================.
#
# -----------------------------------------------------------------------------.
host_name <- function() {
  as.character(Sys.info()["nodename"])
}

# =============================================================================.
#
# -----------------------------------------------------------------------------.
home_path <- function() {
  as.character(Sys.getenv()["HOME"])
}

# SCRIPT INFO ##################################################################

# =============================================================================.
#
# -----------------------------------------------------------------------------.
cmd_name <- function() {
  cmd <- commandArgs()
  cmd <- basename(cmd[grepl("^--file=", cmd, perl = T)])
  cmd
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
cmd_args <- function() {
  paste(commandArgs(trailingOnly = T), collapse = " ")
}
# =============================================================================.
#
# -----------------------------------------------------------------------------.
cmd_line <- function() {
  paste(cmd_name(), cmd_args())
}

