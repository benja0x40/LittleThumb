---
title: "LittleThumb documentation"
subtitle: "`r paste('Package version', packageVersion('LittleThumb'), '-', format(Sys.time(), '%d.%m.%Y'))`"
author: '[Benjamin Leblanc](https://github.com/benja0x40)'
vignette: >
  %\VignetteIndexEntry{LittleThumb documentation}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
fontsize: 11pt
output:
  rmarkdown::html_vignette:
    number_sections: false
    toc: true
    toc_depth: 2
---

```{r message=FALSE, include=FALSE}
library(LittleThumb)

cfg <- LittleThumb()

# DeleteObj(x)
# DeleteObj(a, path = "text")
# DeleteObj(v, path = "values")

unlink("./LT_Tests", recursive = T)
```

### Easy to maintain script structure

We want to compute two R objects.
The first one (`dna`) will be an environment containing data for the sequence
`s` and its alphabet `a`.

The second one (`cgr`) will be a numeric matrix composed of two columns,
corresponding to data `x` and `y`.


```{r eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")

LittleThumb(
  rebuild = list(
    dna = T,
    cgr = T
  ),
  overload = c(
    "a", "s", # used in dna
    "x", "y"  # used in cgr
  )
)

subdir <- list(
  dna = "data_dna",
  cgr = "data_obj2"
)

seq_sim <- function(a, n, l) {
  s <- replicate(n, sample(a, size = l, replace = T), simplify = F)
  names(s) <- paste0("sequence_", 1:n)
}

MakeObj(dna, {
  
  dna <- list(
    alpha = factor(c("A", "C", "G", "T")),
    s_len = 100, # Length of simulated sequences
    s_nbr = 9    # Number of simulated sequences
  )

  MakeObj(sequences, path = subdir$dna, {
    s <- with(dna, seq_sim(alpha, s_nbr, s_len))
  })
  
})

MakeObj(cgr, {
  
  cgr <- list()

  for(i in 1:dna$s_nbr) {
    obj <- names(s)[i]
    MakeObj(name = obj, path = subdir$cgr, {
      s <- with(dna, seq_sim(alpha, s_nbr, s_len))
    })
  }
  
  
})

```


### Repeated script execution using MakeObj

#### Basics

A very simple script named `LT_Test.R`.

```{r script, eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")

MakeObj(x, {
  message("building object x...")
  x <- pi
})
```

First time execution.

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script'}
```

Second time execution without restarting the R environment.

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script'}
```

Second time execution after restarting the R environment.

```{r include=FALSE}
# Simulate restarting the R environment
do.call(LittleThumb, cfg) # Restore default options
suppressWarnings(rm(x))   # Cleanup
```

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script'}
```

#### Forcing to reload R objects

```{r include=FALSE}
x <- 0
```

By default, R object are loaded only if necessary.

```{r eval=FALSE}
x <- 0
source("LT_Test.R")
```
```{r eval=TRUE, message=FALSE, echo=FALSE, results='hide', ref.label='script'}
```

```{r}
print(x)
```

Can be done by changing the `overload` global option.

```{r script_reload, eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")
LittleThumb(overload = T)

MakeObj(x, {
  message("building object x...")
  x <- pi
})
```

Can be done by specifying the `overload` argument when calling `MakeObj`.

```{r eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")

MakeObj(x, overload = T, {
  message("building object x...")
  x <- pi
})
```

Second time execution when forcing to reload the R object.

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script_reload'}
```

```{r}
print(x)
```

```{r include=FALSE}
do.call(LittleThumb, cfg) # Restore default options
```

#### Forcing to rebuild R objects

```{r}
MakeObj(x, { x <- 2 * pi })
```

```{r}
print(x)
```

Can be done by changing the `rebuild` global option.

```{r script_rebuild, eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")
LittleThumb(rebuild = T)

MakeObj(x, {
  message("building object x...")
  x <- 2 * pi
})
```

Can be done by specifying the `rebuild` argument when calling `MakeObj`.

```{r eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests")

MakeObj(x, rebuild = T, {
  message("building object x...")
  x <- 2 * pi
})
```

Second time execution forcing to rebuild the R object.

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script_rebuild'}
```

```{r}
print(x)
```

```{r include=FALSE}
do.call(LittleThumb, cfg) # Restore default options
```

#### Multiple objects, paths and environments

```{r include=FALSE}
# Simulate restarting the R environment
do.call(LittleThumb, cfg) # Restore default options
suppressWarnings(rm(x))   # Cleanup
```

```{r script_multi, eval=FALSE}
library(LittleThumb)

LittleThumb(path = "./LT_Tests", overload = T)

MakeObj(x, { x <- 2 * pi })

MakeObj(data, rebuild = T, {
  
  data <- new.env(parent = globalenv())
  
  MakeObj(k, path = "text", envir = data, {
    k <- LETTERS[1:5]
  })
  
  MakeObj(v, path = "values", envir = data, {
    v <- 1:5
  })

})
```

```{r eval=FALSE}
source("LT_Test.R")
```
```{r eval=TRUE, message=TRUE, echo=FALSE, results='hide', ref.label='script_multi'}
```

```{r}
print(data$k)
print(data$v)
```

```{r include=FALSE}
# Cleanup
DeleteObj(x)
unlink("./LT_Tests", recursive = T)
```

